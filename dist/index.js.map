{
  "version": 3,
  "sources": ["../src/index.ts", "../src/utils.ts", "../src/wechat_v3.ts", "../src/request.ts", "../src/wechatPay.ts"],
  "sourcesContent": ["export { WechatPay } from './wechatPay'\r\nexport * as utils from './utils'\r\nexport { request } from './request'", "import { X509Certificate } from \"crypto\";\r\nimport { URL } from \"url\";\r\n\r\nexport function randomStr(length = 32) {\r\n  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n  var maxPos = chars.length;\r\n  var noceStr = \"\";\r\n  for (var i = 0; i < (length || 32); i++) {\r\n    noceStr += chars.charAt(Math.floor(Math.random() * maxPos));\r\n  }\r\n  return noceStr;\r\n}\r\n\r\nexport function unixTimeStamp() {\r\n  return Math.floor(Date.now() / 1000)\r\n}\r\n\r\nexport function getCertificateSerialNo(buf: Buffer) {\r\n  const x509 = new X509Certificate(buf)\r\n  return x509.serialNumber\r\n}\r\n\r\n\r\nexport function utf8Tobase64(utf8str: string) {\r\n  return Buffer.from(utf8str).toString('base64')\r\n}\r\n\r\nexport function base64ToUtf8(base64str: string) {\r\n  return (Buffer.from(base64str, 'base64').toString())\r\n}\r\n\r\n/**\r\n * \u53BB\u6389\u5BF9\u8C61\u4E2D\u6240\u6709undefined\u548Cnull\r\n * @param obj \r\n * @returns \r\n */\r\nexport function delEmpty(obj: any) {\r\n  const result = { ...obj }\r\n  const oKeys = Object.keys(result)\r\n  for (const key of oKeys) {\r\n    if (result[key] === undefined || result[key] === null) {\r\n      delete result[key]\r\n    }\r\n    if (typeof result[key] === 'object') {\r\n      if (Array.isArray(result[key])) {\r\n        result[key] = result[key].filter((\r\n          item: any) => (item !== undefined && item !== null)\r\n        )\r\n      } else {\r\n        result[key] = delEmpty(result[key])\r\n      }\r\n    }\r\n  }\r\n  return result\r\n}\r\n/**\r\n * \u6392\u9664\u57DF\u540D\u4E2DOrigin \u4F8B\u5982:http://www.a.com/v3/2?a=2 \u7ED3\u679C\u4E3A/v3/2?a=2\r\n * @param url \r\n * @returns \r\n */\r\nexport function urlExclueOrigin(url: string) {\r\n  const _url = new URL(url)\r\n  return url.replace(_url.origin, '')\r\n}\r\n/**\r\n * \u53BB\u9664\u6587\u672C\u6240\u6709\u7A7A\u683C,\u6362\u884C\r\n * @param str \r\n * @returns \r\n */\r\nexport function trimBlank(str: string) {\r\n  return str.replace(/[\\s]/g, '')\r\n}\r\n/**\r\n * \u8FD4\u56DE\u6240\u6709\u6587\u672C\u7684\u957F\u5EA6\r\n * @param args \r\n * @returns \r\n */\r\nexport function allStrLen(...args: string[]) {\r\n  return args.reduce<number>((prev, cur) => {\r\n    return prev + cur.length\r\n  }, 0)\r\n}\r\n/**\r\n * \u6253\u5370\u65E5\u5FD7,flag\u4E3A\u7EFF\u8272.\r\n * @param flag \r\n * @param args \r\n */\r\nexport function log(flag: string, ...args: any) {\r\n  console.log(`\\x1b[32m[${flag}]\\x1b[0m`, ...args)\r\n}\r\n/**\r\n * \u6253\u5370\u9519\u8BEF,flag\u4E3A\u7EA2\u8272\r\n * @param flag \r\n * @param args \r\n */\r\nexport function err(flag: string, ...args: any) {\r\n  console.log(`\\x1b[31m[${flag}]\\x1b[0m`, ...args)\r\n}\r\n/**\r\n * \u6253\u5370\u8B66\u544A,flag\u4E3A\u9EC4\u8272\r\n * @param flag \r\n * @param args \r\n */\r\nexport function warn(flag: string, ...args: any) {\r\n  console.log(`\\x1b[33m[${flag}]\\x1b[0m`, ...args)\r\n}\r\n\r\nexport function intervalDays(comparedA: Date, comparedB: Date) {\r\n  function dateFormat(date: Date) {\r\n    return `${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`\r\n  }\r\n  const a = Date.parse(dateFormat(comparedA))\r\n  const b = Date.parse(dateFormat(comparedB))\r\n  if (a === b) {\r\n    return 0\r\n  }\r\n  return Math.abs(a - b) / (1000 * 60 * 60 * 24)\r\n}\r\n\r\nexport function promiseTry(fn: any) {\r\n  return new Promise((resolve) => resolve(fn()))\r\n}", "import { createDecipheriv, createSign, createVerify, KeyLike, randomUUID, VerifyKeyObjectInput, VerifyPublicKeyInput, X509Certificate } from \"crypto\"\r\nimport { err, getCertificateSerialNo, trimBlank } from \"./utils\"\r\n\r\nexport interface WechatPayV3Config {\r\n  appid: string\r\n  mchid: string\r\n  apikeyV3: string\r\n  publicCert: Buffer\r\n  privateKey: Buffer\r\n  userAgent?: string\r\n}\r\nexport type Methods = 'GET' | 'POST' | 'PUT' | 'DELETE'\r\n\r\n//\u7236\u6A21\u5757\r\nexport class WechatPayV3 {\r\n  protected schema = 'WECHATPAY2-SHA256-RSA2048'\r\n  protected mchCertSerial: string\r\n  protected platformCert: Buffer | null = null\r\n  constructor(protected config: WechatPayV3Config) {\r\n    this.config.userAgent = config.userAgent ?? 'wechatpay/v3'\r\n    this.mchCertSerial = getCertificateSerialNo(config.publicCert).toLowerCase()\r\n  }\r\n  /**\r\n   * \u8BBE\u7F6E\u5FAE\u4FE1\u7684\u5E73\u53F0\u8BC1\u4E66\r\n   * @param cert \r\n   */\r\n  public setPlatformCert(cert: Buffer) {\r\n    this.platformCert = cert\r\n  }\r\n  /**\r\n   * uuidV4,\u8BA2\u5355\u53F7\u53EF\u4EE5\u4F7F\u7528\r\n   * @param disableEntropyCache node\u4E3A\u4E86\u63D0\u9AD8\u6548\u7387,\u4F1A\u751F\u6210\u5E76\u7F13\u5B58\u8DB3\u591F\u591A\u7684\u968F\u673A\u6570\u636E,\u8BBE\u4E3Atrue\u53EF\u4EE5\u5728\u4E0D\u7F13\u5B58\u7684\u60C5\u51B5\u4E0B\u751F\u6210.(\u8003\u8651\u5B9E\u9645\u4F7F\u7528\u60C5\u51B5\u9009\u62E9,\u63A8\u8350\u4FDD\u6301\u9ED8\u8BA4)\r\n   * @returns \r\n   */\r\n  public uuid(disableEntropyCache = false) {\r\n    return randomUUID({ disableEntropyCache: disableEntropyCache })\r\n  }\r\n  /**\r\n   * \u83B7\u53D6\u8BF7\u6C42\u7B7E\u540D\r\n   * @param method \r\n   * @param pathname /v3/xxx \r\n   * @param timeStamp \r\n   * @param nonceStr \r\n   * @param body \r\n   * @returns \r\n   */\r\n  protected getSignature(method: Methods, pathname: string, timeStamp: number | string, nonceStr: string, body?: object | string) {\r\n    if (body) {\r\n      if (body instanceof Object) {\r\n        body = JSON.stringify(body)\r\n      }\r\n    } else {\r\n      body = ''\r\n    }\r\n    const data = [method, pathname, timeStamp, nonceStr, body].join('\\n') + '\\n'\r\n    return this.sha256WithRsaSign(data)\r\n  }\r\n  /**\r\n   * \u83B7\u53D6\u6388\u6743\u5934\r\n   * @param nonceStr 32\u4F4D\u968F\u673A\u5B57\u7B26\u4E32\r\n   * @param timeStamp \u65F6\u95F4\u6233\r\n   * @param signature \u8BF7\u6C42\u7B7E\u540D\r\n   * 1\r\n   */\r\n  protected getAuthorization(nonceStr: string, timeStamp: string | number, signature: string) {\r\n    return (\r\n      this.schema + ' ' + trimBlank(`\r\n        mchid=\"${this.config.mchid}\",\r\n        nonce_str=\"${nonceStr}\",\r\n        timestamp=\"${timeStamp}\",\r\n        serial_no=\"${this.mchCertSerial}\",\r\n        signature=\"${signature}\"\r\n        `)\r\n    )\r\n  }\r\n  /**\r\n   * sha256WithRsa\u52A0\u5BC6\r\n   * @param plaintext \u88AB\u52A0\u5BC6\u7684\u6570\u636E\r\n   * @returns \r\n   */\r\n  protected sha256WithRsaSign(plaintext: string) {\r\n    return createSign('RSA-SHA256').update(plaintext).sign(this.config.privateKey, 'base64')\r\n  }\r\n  /**\r\n   * \u9A8C\u8BC1\u5FAE\u4FE1\u5E73\u53F0\u54CD\u5E94\u7B7E\u540D\r\n   * @param publicKey \u5E73\u53F0\u516C\u94A5\r\n   * @param signature \r\n   * @param data \r\n   * @returns \r\n   */\r\n  protected sha256WithRsaVerify(publicKey: KeyLike | VerifyKeyObjectInput | VerifyPublicKeyInput, signature: string, data: string) {\r\n    return createVerify('RSA-SHA256').update(data).verify(publicKey, signature, 'base64')\r\n  }\r\n  /**\r\n   * \u89E3\u5BC6\u5E73\u53F0\u54CD\u5E94\r\n   * @param nonce \r\n   * @param associatedData \r\n   * @param ciphertext \r\n   * @returns \r\n   */\r\n  protected aesGcmDecrypt(nonce: string, associatedData: string, ciphertext: string) {\r\n    try {\r\n      let ciphertextBuffer = Buffer.from(ciphertext, 'base64')\r\n      let authTag = ciphertextBuffer.slice(ciphertextBuffer.length - 16)\r\n      let data = ciphertextBuffer.slice(0, ciphertextBuffer.length - 16)\r\n      let decipherIv = createDecipheriv('aes-256-gcm', this.config.apikeyV3, nonce)\r\n      decipherIv.setAuthTag(authTag)\r\n      decipherIv.setAAD(Buffer.from(associatedData))\r\n      let decryptBuf = decipherIv.update(data)\r\n      decipherIv.final()\r\n      return decryptBuf\r\n    } catch (error) {\r\n      err('\u5BC6\u94A5\u89E3\u5BC6\u5931\u8D25', '\u8BF7\u68C0\u67E5\u5E73\u53F0\u914D\u7F6E\u5BC6\u94A5\u662F\u5426\u6B63\u786E')\r\n      throw error;\r\n    }\r\n  }\r\n  /**\r\n   * \u521B\u5EFA\u9A8C\u7B7E\u540D\u4E32\r\n   * @param resTimestamp \u53C2\u6570\u5728\u54CD\u5E94\u5934\u4E2D\u5BF9\u5E94\r\n   * @param resNonce \u53C2\u6570\u5728\u54CD\u5E94\u5934\u4E2D\u5BF9\u5E94\r\n   * @param resBody \u53C2\u6570\u5728\u54CD\u5E94\u5934\u4E2D\u5BF9\u5E94\r\n   * @returns \r\n   */\r\n  protected buildVerifyStr(resTimestamp: string, resNonce: string, resBody: string) {\r\n    return [resTimestamp, resNonce, resBody].join('\\n') + '\\n'\r\n  }\r\n}\r\n\r\n", "import http, { IncomingMessage, RequestOptions } from 'http'\r\nimport https from 'https'\r\nimport os from 'os'\r\nimport { URL } from 'url'\r\n\r\n\r\ninterface RequestConifg {\r\n  url: string\r\n  method?: Methods\r\n  headers?: http.OutgoingHttpHeaders\r\n}\r\n\r\nclass Request {\r\n  protected clientRequest: http.ClientRequest\r\n\r\n  constructor(\r\n    protected url: string,\r\n    protected method: Methods = 'GET'\r\n  ) {\r\n    this.clientRequest = this.buildRequest({\r\n      method: this.method,\r\n      url: this.url,\r\n      headers: {\r\n        'User-Agent': `${os.version()}/${os.release()}`\r\n      }\r\n    })\r\n  }\r\n  setTimeout(timeout: number, callback?: () => void) {\r\n    const _callback = () => {\r\n      if (callback) {\r\n        callback()\r\n      }\r\n    }\r\n    this.clientRequest.setTimeout(timeout, _callback)\r\n    return this\r\n  }\r\n  setHeader(headers: http.OutgoingHttpHeaders): this\r\n  setHeader(name: string, value: string | number | readonly string[]): this\r\n  setHeader(...args: any): this {\r\n    switch (args.length) {\r\n      case 1:\r\n        const headers = args[0]\r\n        for (const key of Object.keys(headers)) {\r\n          this.clientRequest.setHeader(key, headers[key])\r\n        }\r\n        break;\r\n      case 2:\r\n        const name = args[0], value = args[1]\r\n        this.clientRequest.setHeader(name, value)\r\n        break;\r\n      default:\r\n        err('WrongCall', 'setHeader nonsupport', ...args)\r\n        break;\r\n    }\r\n    return this\r\n  }\r\n  write(data?: Buffer | string | object) {\r\n    if (getType(data) === 'object') {\r\n      data = JSON.stringify(data)\r\n    }\r\n    //@ts-ignore\r\n    this.clientRequest.write((data as Buffer | string))\r\n    return this\r\n  }\r\n  end() {\r\n    return new Promise((resolve, reject) => {\r\n      this.clientRequest.on('error', err => {\r\n        reject(err)\r\n      })\r\n      this.clientRequest.on('timeout', () => {\r\n        reject(new Error('timeout'))\r\n      })\r\n      this.clientRequest.on('response', res => {\r\n        res.on('error', err => {\r\n          reject(err)\r\n        })\r\n        let data = ''\r\n        res.on('data', (chunk) => {\r\n          data += chunk.toString()\r\n        })\r\n        res.on('end', async () => {\r\n          return resolve({\r\n            res: res,\r\n            status: res?.statusCode,\r\n            statusMessage: res?.statusMessage,\r\n            headers: res.headers,\r\n            data: data\r\n          })\r\n        })\r\n\r\n      })\r\n      this.clientRequest.end()\r\n    }) as Promise<{\r\n      res: http.IncomingMessage,\r\n      status: number | undefined,\r\n      statusMessage: string | undefined,\r\n      headers: http.IncomingHttpHeaders,\r\n      data: string\r\n    }>\r\n  }\r\n  private buildRequest({ method, url, headers }: RequestConifg) {\r\n    const _url = new URL(url)\r\n    let adapter: (url: string | URL, options: RequestOptions, callback?: (res: IncomingMessage) => void) => http.ClientRequest;\r\n    switch (_url.protocol) {\r\n      case 'http:':\r\n        adapter = http.request\r\n        break;\r\n      case 'https:':\r\n        adapter = https.request\r\n        break;\r\n      default:\r\n        throw new TypeError(`nonsupport this protocol ${_url.protocol}`);\r\n    }\r\n    const req = adapter(url, {\r\n      headers,\r\n      method,\r\n    })\r\n\r\n    return req\r\n  }\r\n}\r\n/**\r\n * \u666E\u901A\u7684\u8BF7\u6C42\u5C01\u88C5,\u4E3A\u4E86\u4E0D\u6DFB\u52A0\u4F9D\u8D56\u6240\u5199.\r\n * @param url \r\n * @param method \r\n * @returns \r\n */\r\nexport function request(url: string, method?: Methods) {\r\n  return new Request(url, method)\r\n}\r\n\r\n\r\nfunction getType(any: any): string | null | undefined {\r\n  switch (typeof any) {\r\n    case 'bigint':\r\n      return 'bigint'\r\n    case 'boolean':\r\n      return 'boolean'\r\n    case 'function':\r\n      return 'function'\r\n    case 'number':\r\n      return 'number'\r\n    case 'string':\r\n      return 'string'\r\n    case 'symbol':\r\n      return 'symbol'\r\n    case 'undefined':\r\n      return undefined\r\n    case 'object':\r\n      if (Array.isArray(any)) {\r\n        return 'array'\r\n      } else if (any === null) {\r\n        return null\r\n      }\r\n      let str = (Object.prototype.toString.call(any) as string)\r\n      if (str !== '') {\r\n        str = str.slice(8, -1)\r\n      } else {\r\n        try {\r\n          //@ts-ignore\r\n          str = Object.getPrototypeOf(any)?.constructor?.name\r\n        } catch (error) {\r\n          str = ''\r\n        }\r\n\r\n      }\r\n      str = str !== '' ? str : 'object'\r\n      return str.toLowerCase()\r\n  }\r\n}\r\n\r\ntype Methods = (\r\n  'ACL' | 'BIND' | 'CHECKOUT' | 'CONNECT' | 'COPY' | 'DELETE' |\r\n  'GET' | 'HEAD' | 'LINK' | 'LOCK' | 'M-SEARCH' | 'MERGE' |\r\n  'MKACTIVITY' | 'MKCALENDAR' | 'MKCOL' | 'MOVE' | 'NOTIFY' | 'OPTIONS' |\r\n  'PATCH' | 'POST' | 'PROPFIND' | 'PROPPATCH' | 'PURGE' | 'PUT' |\r\n  'REBIND' | 'REPORT' | 'SEARCH' | 'SOURCE' | 'SUBSCRIBE' | 'TRACE' |\r\n  'UNBIND' | 'UNLINK' | 'UNLOCK' | 'UNSUBSCRIBE'\r\n)\r\n\r\nfunction err(flag: string, ...args: any) {\r\n  console.log(`\\x1b[31m[Req-${flag}]\\x1b[0m`, ...args)\r\n}", "import { err, intervalDays, log, randomStr, unixTimeStamp, urlExclueOrigin, warn } from \"./utils\";\r\nimport { Methods, WechatPayV3 } from \"./wechat_v3\";\r\nimport { request } from './request'\r\n\r\nexport class WechatPay extends WechatPayV3 {\r\n  private autoUpdatePlatformCertOption: {\r\n    schema: false | 'task' | 'onReq',\r\n    updataAt: Date | null,\r\n    timer: NodeJS.Timeout | undefined,\r\n    retryCount: number\r\n  } = {\r\n      schema: false,\r\n      updataAt: null,\r\n      timer: undefined,\r\n      retryCount: 0\r\n    }\r\n  /**\r\n   * \u6784\u5EFA\u8BF7\u6C42\u7684\u8BA4\u8BC1\u6570\u636E\r\n   * @param method \r\n   * @param url \r\n   * @param param \r\n   * @returns \r\n   */\r\n  buildRequestAuth(method: Methods, url: string, param?: object) {\r\n    const timeStamp = unixTimeStamp()\r\n    const nonceStr = randomStr()\r\n    const signture = this.getSignature(method,\r\n      urlExclueOrigin(url),\r\n      timeStamp,\r\n      nonceStr,\r\n      param\r\n    )\r\n    const auth = this.getAuthorization(nonceStr, timeStamp, signture)\r\n    return auth\r\n  }\r\n  /**\r\n  * \u5F53\u4F60\u8003\u8651\u4F7F\u7528\u6B64\u65B9\u6CD5\u6765\u6EE1\u8DB3\u4F60\u66F4\u591A\u7684\u9700\u6C42\u65F6,\u53EF\u4EE5\u63D0\u4E2Apr\u6765\u5B8C\u5584\u5B83\r\n  */\r\n  async post(url: string, params: object, auth: string, verify = true) {\r\n    const { data, status, headers } = await request(url, 'POST')\r\n      .setHeader({\r\n        Accept: 'application/json',\r\n        'Content-Type': 'application/json',\r\n        'User-Agent': this.config.userAgent,\r\n        Authorization: auth,\r\n      })\r\n      .setTimeout(10000)\r\n      .write(params)\r\n      .end()\r\n    let _verify: 'noVerify' | boolean = 'noVerify'\r\n    if (verify) {\r\n      if (!this.platformCert) {\r\n        warn(\r\n          '\u9A8C\u7B7E\u8B66\u544A',\r\n          '\\n      \u5F53\u524D\u8C03\u7528\u5F00\u542F\u4E86\u9A8C\u7B7E,\u4F46\u5E76\u672A\u627E\u5230\u5E73\u53F0\u8BC1\u4E66.',\r\n          '\\n      \u8003\u8651\u5230\u90E8\u5206\u590D\u6742\u60C5\u51B5,\u6CA1\u6709\u6DFB\u52A0\u5F00\u542F\u9A8C\u8BC1\u5219\u81EA\u52A8\u8BBE\u7F6E\u5E73\u53F0\u8BC1\u4E66.',\r\n          '\\n      \u8BF7\u8C03\u7528setPlatformCert\u8BBE\u7F6E\u5E73\u53F0\u8BC1\u4E66\u6216\u8005autoUpdatePlatformCert\u5F00\u542F\u81EA\u52A8\u66F4\u65B0\u8BC1\u4E66.',\r\n        )\r\n      }\r\n      _verify = this.verifyRes(data, headers as any)\r\n    }\r\n    return {\r\n      verify: _verify,\r\n      headers,\r\n      status,\r\n      data,\r\n    }\r\n  }\r\n  /**\r\n  * \u5F53\u4F60\u8003\u8651\u4F7F\u7528\u6B64\u65B9\u6CD5\u6765\u6EE1\u8DB3\u4F60\u66F4\u591A\u7684\u9700\u6C42\u65F6,\u53EF\u4EE5\u63D0\u4E2Apr\u6765\u5B8C\u5584\u5B83\r\n  */\r\n  async get(url: string, auth: string, verify = true) {\r\n\r\n    const { data, status, headers } = await request(url, 'GET')\r\n      .setHeader({\r\n        Accept: 'application/json',\r\n        'Content-Type': 'application/json',\r\n        'User-Agent': this.config.userAgent,\r\n        Authorization: auth,\r\n      })\r\n      .setTimeout(10000)\r\n      .end()\r\n    let _verify: 'noVerify' | boolean = 'noVerify'\r\n    if (verify) {\r\n      if (!this.platformCert) {\r\n        if (this.autoUpdatePlatformCertOption.schema === 'onReq') {\r\n          //\u95F4\u9694\u4E0D\u6EE1\u4E00\u5929,\u8FD9\u91CC\u7684\u4E00\u5929\u5B58\u7CB9\u662F\u65E5\u671F\u7684\u4E00\u5929,\u5047\u5982\u665A11\u70B9\u5F00\u542F\u7684\u81EA\u52A8\u66F4\u65B0,\u90A3\u4E48\u6B21\u65E50\u70B9\u5C31\u4F1A\u66F4\u65B0\r\n          if (this.autoUpdatePlatformCertOption.updataAt) {\r\n            if (intervalDays(this.autoUpdatePlatformCertOption.updataAt, new Date) !== 0) {\r\n              await this.autoUpdatePlatformCert('onReq')\r\n            }\r\n          }\r\n        } else {\r\n          warn(\r\n            '\u9A8C\u7B7E\u8B66\u544A',\r\n            '\\n      \u5F53\u524D\u8C03\u7528\u5F00\u542F\u4E86\u9A8C\u7B7E,\u4F46\u5E76\u672A\u627E\u5230\u5E73\u53F0\u8BC1\u4E66.\u8003\u8651\u5230\u90E8\u5206\u60C5\u51B5,\u7A0B\u5E8F\u4E0D\u4F1A\u81EA\u52A8\u8BBE\u7F6E\u5E73\u53F0\u8BC1\u4E66.',\r\n            '\\n      \u8BF7\u8C03\u7528setPlatformCert\u8BBE\u7F6E\u5E73\u53F0\u8BC1\u4E66\u6216\u8005autoUpdatePlatformCert\u5F00\u542F\u81EA\u52A8\u66F4\u65B0\u8BC1\u4E66.',\r\n          )\r\n        }\r\n      }\r\n      _verify = this.verifyRes(data, headers as any)\r\n    }\r\n    return {\r\n      verify: _verify,\r\n      headers,\r\n      status,\r\n      data,\r\n    }\r\n  }\r\n  /**\r\n   * https://pay.weixin.qq.com/wiki/doc/apiv3/wechatpay/wechatpay5_0.shtml\r\n   * @description \u8BF7\u6839\u636E\u5B9E\u9645\u60C5\u51B5\u9009\u62E9,\u4E1A\u52A1\u91CF\u5927\u65F6'task'\u66F4\u597D,\u53CD\u4E4B\u4F7F\u7528'onReq'\r\n   * @param schema 'task' \u4E3A\u5B9A\u671F\u4EFB\u52A1,\u6BCF12\u5C0F\u65F6\u6267\u884C. 'onReq'\u4E3A\u8BF7\u6C42\u65F6\u88AB\u52A8\u89E6\u53D1,\u6BCF\u65E5\u53D8\u66F4.\r\n   * @returns \r\n   */\r\n  async autoUpdatePlatformCert(schema: 'task' | 'onReq' | false) {\r\n    this.autoUpdatePlatformCertOption.schema = schema\r\n    if (schema === false) {\r\n      return false\r\n    }\r\n    const flag = `${new Date} - \u81EA\u52A8\u66F4\u65B0\u8BC1\u4E66`\r\n    const cert = await this.getPlatformCert()\r\n\r\n    if (this.autoUpdatePlatformCertOption.timer) {\r\n      clearTimeout(this.autoUpdatePlatformCertOption.timer)\r\n    }\r\n    if (!cert) {\r\n      err(flag, `\u66F4\u65B0\u5931\u8D25!${this.autoUpdatePlatformCertOption.retryCount * 5}\u79D2\u540E\u91CD\u8BD5!`)\r\n      if (this.autoUpdatePlatformCertOption.retryCount > 5) {\r\n        err(flag, `\u91CD\u8BD5\u6B21\u6570\u8D85\u8FC7\u4E0A\u9650!\u81EA\u52A8\u66F4\u65B0\u5E73\u53F0\u8BC1\u4E66\u88AB\u5173\u95ED!`)\r\n        this.autoUpdatePlatformCert(false)\r\n      }\r\n      this.autoUpdatePlatformCertOption.timer = setTimeout(() => {\r\n        this.autoUpdatePlatformCertOption.retryCount += 1\r\n        log(`\u7B2C${this.autoUpdatePlatformCertOption.retryCount}\u6B21\u91CD\u8BD5!`)\r\n        this.autoUpdatePlatformCert(this.autoUpdatePlatformCertOption.schema)\r\n      }, this.autoUpdatePlatformCertOption.retryCount * 5 * 1000)\r\n      return false\r\n    }\r\n\r\n    switch (schema) {\r\n      case 'task':\r\n        this.autoUpdatePlatformCertOption.timer = setTimeout(() => {\r\n          this.autoUpdatePlatformCert('task')\r\n        }, 60 * 1000 * 60 * 12)\r\n      case 'onReq':\r\n        this.setPlatformCert(cert)\r\n        this.autoUpdatePlatformCertOption.updataAt = new Date\r\n        log(flag, '\u66F4\u65B0\u6210\u529F!')\r\n    }\r\n    return true\r\n  }\r\n  /**\r\n     * \u5982\u679C\u5E73\u53F0\u8BC1\u4E66\u5B58\u5728,\u5219\u6240\u6709\u54CD\u5E94\u90FD\u4F1A\u9A8C\u8BC1\u7B7E\u540D,\u8FD4\u56DEboolean.\r\n     * \u5982\u679C\u8BC1\u4E66\u4E0D\u5B58\u5728,\u8868\u793A\u4E00\u5F8B\u901A\u8FC7,\u5168\u90E8\u8BF7\u6C42\u8FD4\u56DE noVerify.\r\n     * \u4F60\u53EF\u4EE5\u9009\u62E9\u5FFD\u7565,\u4F46\u5728\u5904\u7406\u654F\u611F\u64CD\u4F5C\u65F6,\u6709\u5FC5\u8981\u6839\u636E\u9A8C\u7B7E\u7ED3\u679C\u8FDB\u884C\u5904\u7406.\r\n     * @param body \r\n     * @param headers \r\n     */\r\n  verifyRes(body: string, headers: { [key: string]: string }) {\r\n    if (this.platformCert) {\r\n      const data = this.buildVerifyStr(\r\n        headers['wechatpay-timestamp'],\r\n        headers['wechatpay-nonce'],\r\n        body\r\n      )\r\n      return this.sha256WithRsaVerify(this.platformCert, headers['wechatpay-signature'], data)\r\n    }\r\n    return 'noVerify'\r\n  }\r\n\r\n  async closeOrder(out_trade_no: string) {\r\n    const params = {\r\n      mchid: this.config.mchid\r\n    }\r\n    const url = `https://api.mch.weixin.qq.com/v3/pay/transactions/out-trade-no/${out_trade_no}/close`\r\n    const auth = this.buildRequestAuth('POST', url, params)\r\n    const res = await this.post(url, params, auth, false)\r\n    return { status: res.status, success: res.status === 204 }\r\n  }\r\n  /**\r\n * App\u4E0B\u5355\r\n * @param order \u8BA2\u5355\u8BE6\u60C5\r\n * @returns \r\n */\r\n  async orderFromApp(order: OrderConfig) {\r\n    const params = {\r\n      ...order,\r\n      appid: this.config.appid,\r\n      mchid: this.config.mchid,\r\n    }\r\n    const url = 'https://api.mch.weixin.qq.com/v3/pay/transactions/app'\r\n    const auth = this.buildRequestAuth('POST', url, params)\r\n    const res = await this.post(url, params, auth)\r\n    return {\r\n      verify: res.verify,\r\n      status: res.status,\r\n      data: JSON.parse(res.data) as {\r\n        prepay_id?: string\r\n      },\r\n      /**\r\n       * \u62FF\u5230\u9884\u652F\u4ED8\u4EA4\u6613\u4F1A\u8BDDID\u751F\u6210\u524D\u7AEF\u6240\u9700\u8981\u7684\u6570\u636E\r\n       * @param perpay_id \u9884\u652F\u4ED8\u4EA4\u6613\u4F1A\u8BDDID\r\n       * @returns \r\n       */\r\n      callToPay: (perpay_id: string) => {\r\n        const nonce_str = randomStr()\r\n        const timeStamp = unixTimeStamp().toString()\r\n        const sginStr = [this.config.appid, timeStamp, nonce_str, perpay_id].join('\\n') + '\\n'\r\n        const signature = this.sha256WithRsaSign(sginStr)\r\n        return {\r\n          signature,\r\n          appId: this.config.appid,\r\n          partnerid: this.config.mchid,\r\n          prepayid: perpay_id,\r\n          package: 'Sign=WXPay',\r\n          noncestr: nonce_str,\r\n          timestamp: timeStamp,\r\n        }\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \u83B7\u53D6\u8BA2\u5355\r\n   * @param id \r\n   * @param type id\u7C7B\u578B,transaction_id\u4E3A\u5FAE\u4FE1\u652F\u4ED8\u8BA2\u5355\u53F7,out_trade_no\u4E3A\u5546\u5BB6\u8BA2\u5355\u53F7\r\n   */\r\n  async getOrder(id: string, type: 'transaction_id' | 'out_trade_no') {\r\n    let url = type === 'out_trade_no'\r\n      ? `https://api.mch.weixin.qq.com/v3/pay/transactions/out-trade-no/${id}`\r\n      : `https://api.mch.weixin.qq.com/v3/pay/transactions/id/${id}`\r\n    url += '?mchid=' + this.config.mchid\r\n    const auth = this.buildRequestAuth('GET', url)\r\n    const res = await this.get(url, auth)\r\n    return {\r\n      verify: res.verify,\r\n      status: res.status,\r\n      data: JSON.parse(res.data) as {\r\n        trade_state: 'SUCCESS' | 'REFUND' | 'NOTPAY' | 'CLOSED' | 'REVOKED' | 'USERPAYING' | 'PAYERROR' | 'ACCEPT'\r\n        [key: string]: any\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * \u83B7\u53D6\u5FAE\u4FE1\u8BC1\u4E66\u7528\u4E8E\u9A8C\u7B7E\u4F7F\u7528,\u5FAE\u4FE1\u5B98\u65B9\u63A8\u835012\u5C0F\u65F6\u5185\u8FDB\u884C\u4E00\u6B21\u83B7\u53D6\r\n   * sdk\u63D0\u4F9B\u4E86\u81EA\u52A8\u66F4\u65B0\u4E14\u5E94\u7528\u65B0\u8BC1\u4E66\u7684\u65B9\u6CD5 autoUpdatePlatformCert\r\n   */\r\n  async getPlatformCert() {\r\n    const url = 'https://api.mch.weixin.qq.com/v3/certificates'\r\n    const auth = this.buildRequestAuth('GET', url)\r\n\r\n    const { headers, data, status } = await this.get(url, auth, false)\r\n    if (status === 200 && headers) {\r\n      const body = JSON.parse(data)\r\n      for (let i = 0; i < body.data.length; i++) {\r\n        const cert = body.data[i] as PlatformCert\r\n        //\u5224\u65AD\u5934\u4FE1\u606F,\u62FF\u5230\u5F53\u524D\u5E73\u53F0\u8BC1\u4E66\r\n        if (cert.serial_no === headers['wechatpay-serial']) {\r\n          //\u89E3\u5BC6\u62FF\u5230\u7684\u5E73\u53F0\u8BC1\u4E66\r\n          const rltCert = this.aesGcmDecrypt(\r\n            cert.encrypt_certificate.nonce,\r\n            cert.encrypt_certificate.associated_data,\r\n            cert.encrypt_certificate.ciphertext\r\n          )\r\n          //\u76F4\u63A5\u62FF\u8FD4\u56DE\u7684\u65B0\u8BC1\u4E66\u8FDB\u884C\u81EA\u8EAB\u7684\u9A8C\u7B7E.\r\n          if (this.sha256WithRsaVerify(\r\n            rltCert,\r\n            headers['wechatpay-signature'] as string,\r\n            this.buildVerifyStr(\r\n              headers['wechatpay-timestamp'] as string,\r\n              headers['wechatpay-nonce'] as string,\r\n              data\r\n            )\r\n          )) {\r\n            //\u9A8C\u7B7E\u6210\u529F\u5219\u8FD4\u56DE\u8BC1\u4E66\r\n            return rltCert\r\n          }\r\n        }\r\n      }\r\n    }\r\n    //\u975E\u7F51\u7EDC\u73AF\u5883\u5BFC\u81F4\u5931\u8D25\u7684\u60C5\u51B5\u5E94\u5F53\u505C\u673A\u5E76\u6253\u5370\u65E5\u5FD7,\u8003\u8651\u88AB\u52AB\u6301\u6570\u636E\u7BE1\u6539\u7684\u60C5\u51B5\r\n    //\u5BC6\u94A5\u4FDD\u5B58\u5F97\u5F53\u867D\u7136\u4E0D\u4F1A\u906D\u9047\u592A\u5927\u95EE\u9898,\u4F46\u8FD9\u4EE3\u8868\u89E3\u5BC6\u7684\u540E\u6570\u636E\u5C06\u65E0\u6CD5\u4F7F\u7528\u6216\u62A5\u9519(\u5177\u4F53\u62A5\u9519\u8FD8\u662F\u600E\u4E48\u6837\u6CA1\u6D4B\u8FC7),\u53EF\u80FD\u5BFC\u81F4\u8FDE\u9501bug\r\n    return undefined\r\n  }\r\n  /**\r\n   * \u9000\u6B3E\r\n   * @param config \r\n   * @returns \r\n   */\r\n  async refund(config: RefundConfig & (RefundConfig_id1 | RefundConfig_id2)) {\r\n    const url = 'https://api.mch.weixin.qq.com/v3/refund/domestic/refunds'\r\n    const auth = this.buildRequestAuth('POST', url, config)\r\n    const res = await this.post(url, config, auth)\r\n    return {\r\n      verify: res.verify,\r\n      status: res.status,\r\n      data: JSON.parse(res.data)\r\n    }\r\n  }\r\n}\r\n/**\r\n * \u7ED9\u51FA\u7684\u63A5\u53E3\u53C2\u6570\u4E3A\u63A8\u8350\u53C2\u6570\u5E76\u975E\u5168\u90E8\u53C2\u6570,\u8BF7\u53C2\u9605\u5FAE\u4FE1\u5B98\u65B9\u6587\u6863\r\n */\r\ninterface OrderConfig {\r\n  amount: {\r\n    total: number\r\n  },\r\n  description: string,\r\n  notify_url: string,\r\n  out_trade_no: string\r\n  [key: string]: any\r\n}\r\n\r\ninterface PlatformCert {\r\n  effective_time: string,\r\n  encrypt_certificate: {\r\n    algorithm: string,\r\n    associated_data: string,\r\n    ciphertext: string,\r\n    nonce: string\r\n  },\r\n  expire_time: string,\r\n  serial_no: string\r\n}\r\ninterface RefundConfig_id1 {\r\n  transaction_id: string\r\n}\r\ninterface RefundConfig_id2 {\r\n  out_trade_no: string\r\n}\r\n/**\r\n * \u7ED9\u51FA\u7684\u63A5\u53E3\u53C2\u6570\u4E3A\u63A8\u8350\u53C2\u6570\u5E76\u975E\u5168\u90E8\u53C2\u6570,\u8BF7\u53C2\u9605\u5FAE\u4FE1\u5B98\u65B9\u6587\u6863\r\n */\r\ninterface RefundConfig {\r\n  /**\u5546\u6237\u5185\u90E8\u9000\u6B3E\u5355\u53F7*/\r\n  out_refund_no: string\r\n  /**\u9000\u6B3E\u539F\u56E0*/\r\n  reason?: string\r\n  notify_url?: string\r\n  /**\u9ED8\u8BA4\u4F7F\u7528\u672A\u7ED3\u7B97\u8D44\u91D1\u9000\u6B3E */\r\n  funds_account?: 'AVAILABLE'\r\n  amount: {\r\n    /**\u9000\u6B3E\u91D1\u989D */\r\n    refund: number\r\n    /**\u539F\u652F\u4ED8\u4EA4\u6613\u7684\u8BA2\u5355\u603B\u91D1\u989D */\r\n    total: number\r\n    currency: 'CNY'\r\n  }\r\n}"],
  "mappings": "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",
  "names": []
}
